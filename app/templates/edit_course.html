{% extends "base.html" %} {% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
        <div class="p-6 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50">
            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Edit Course Settings</h1>
            <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Customize how this course appears in your dashboard.</p>
        </div>

        <form action="{{ url_for('edit_course', course_id=google_course_id) }}" method="POST" class="p-6 space-y-6">
            <!-- Basic Info Section -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-slate-900 dark:text-white uppercase tracking-wider mb-4">Display Information</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="custom_name">Course Name</label>
                        <input
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                            id="custom_name"
                            name="custom_name"
                            type="text"
                            placeholder="e.g. AP Calculus"
                            value="{{ course.custom_name if course.custom_name else '' }}"
                        />
                    </div>

                    <div>
                        <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="custom_section">Section</label>
                        <input
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                            id="custom_section"
                            name="custom_section"
                            type="text"
                            placeholder="e.g. Period 3"
                            value="{{ course.custom_section if course.custom_section else '' }}"
                        />
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="custom_teacher_name">Teacher Name</label>
                        <input
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                            id="custom_teacher_name"
                            name="custom_teacher_name"
                            type="text"
                            placeholder="e.g. Mr. Smith"
                            value="{{ course.custom_teacher_name if course.custom_teacher_name else '' }}"
                        />
                    </div>

                    <div>
                        <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="custom_code">Class Code (Display Only)</label>
                        <input
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all font-mono text-sm"
                            id="custom_code"
                            name="custom_code"
                            type="text"
                            placeholder="e.g. abc-123"
                            value="{{ course.custom_code if course.custom_code else '' }}"
                        />
                    </div>
                </div>
            </div>

            <hr class="border-slate-100 dark:border-slate-700" />

            <!-- Appearance Section -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-slate-900 dark:text-white uppercase tracking-wider mb-4">Appearance & Organization</h3>

                <div>
                    <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="custom_banner">Banner Image URL</label>
                    <input
                        class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
                        id="custom_banner"
                        name="custom_banner"
                        type="text"
                        placeholder="https://example.com/image.jpg"
                        value="{{ course.custom_banner if course.custom_banner else '' }}"
                    />
                    <p class="text-xs text-slate-500 mt-1">Leave empty to use the default gradient.</p>
                </div>

                <div>
                    <label class="block text-slate-700 dark:text-slate-300 text-sm font-medium mb-2" for="tags">Tags (Max 12)</label>
                    <div
                        id="tag-input-container"
                        class="flex flex-wrap items-center gap-2 w-full px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 focus-within:ring-2 focus-within:ring-primary-500 focus-within:border-transparent transition-all cursor-text min-h-[46px]"
                        onclick="document.getElementById('tag-input').focus()"
                    >
                        <!-- Tags will be inserted here -->
                        <input id="tag-input" type="text" class="flex-grow bg-transparent outline-none text-slate-700 dark:text-white min-w-[80px] text-sm placeholder-slate-400" placeholder="Type and press Enter..." />
                    </div>
                    <input type="hidden" name="tags" id="hidden-tags-input" value="{{ course.user_tags|map(attribute='name')|join(',') }}" />
                </div>

                <div class="pt-2">
                    <label class="flex items-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer transition-colors">
                        <input type="checkbox" name="is_archived" class="w-5 h-5 text-primary-600 rounded border-gray-300 focus:ring-primary-500" {% if course.is_archived %}checked{% endif %} />
                        <span class="ml-3 text-slate-700 dark:text-slate-300 font-medium">Archive this course</span>
                    </label>
                    <p class="text-xs text-slate-500 mt-1 ml-1">Archived courses are hidden from the main dashboard view.</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center justify-end gap-4 pt-6 border-t border-slate-100 dark:border-slate-700">
                <a href="{{ url_for('index') }}" class="px-6 py-2.5 rounded-xl text-slate-600 dark:text-slate-300 font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">Cancel</a>
                <button class="px-6 py-2.5 rounded-xl bg-primary-600 hover:bg-primary-700 text-white font-bold shadow-lg shadow-primary-500/30 transition-all transform hover:scale-[1.02]" type="submit">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("tag-input-container");
        const input = document.getElementById("tag-input");
        const hiddenInput = document.getElementById("hidden-tags-input");

        let tags = hiddenInput.value
            .split(",")
            .map((t) => t.trim())
            .filter((t) => t);

        function renderTags() {
            // Remove existing tag elements (keep input)
            const existingTags = container.querySelectorAll(".tag-capsule");
            existingTags.forEach((el) => el.remove());

            // Insert tags before input
            tags.forEach((tag, index) => {
                const tagEl = document.createElement("div");
                tagEl.className = "tag-capsule flex items-center gap-1 bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 px-2.5 py-1 rounded-lg text-sm font-medium border border-primary-100 dark:border-primary-800";
                tagEl.innerHTML = `
                    <span>${tag}</span>
                    <button type="button" class="hover:text-primary-900 dark:hover:text-primary-100 focus:outline-none ml-1" onclick="removeTag(${index})">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                `;
                container.insertBefore(tagEl, input);
            });

            hiddenInput.value = tags.join(",");
        }

        window.removeTag = function (index) {
            tags.splice(index, 1);
            renderTags();
        };

        input.addEventListener("keydown", function (e) {
            if (e.key === "Enter" || e.key === ",") {
                e.preventDefault();
                const val = input.value.trim().replace(",", "");
                if (val && !tags.includes(val)) {
                    if (tags.length >= 12) {
                        alert("Tag limit reached (12)");
                        return;
                    }
                    tags.push(val);
                    input.value = "";
                    renderTags();
                } else if (tags.includes(val)) {
                    input.value = ""; // Clear duplicate
                }
            } else if (e.key === "Backspace" && !input.value && tags.length > 0) {
                tags.pop();
                renderTags();
            }
        });

        // Initial render
        renderTags();
    });
</script>
{% endblock %}
